 -- Для корректного просмотра нужно перейти в режим редактирования.
 
 -- Создадим БД
DROP DATABASE IF EXISTS lesson2; -- Удаляем БД, если она существует
CREATE DATABASE IF NOT EXISTS lesson2; -- Создаю БД, если она ранее не существовала

-- DDL: CREATE, DROP, ALTER, RENAME, TRUNCATE 
USE lesson2;
DROP TABLE IF EXISTS movie;
CREATE TABLE IF NOT EXISTS movie
(
	# имя_столбца тип_данных свойства
    id INT PRIMARY KEY AUTO_INCREMENT, -- столбец id, целое число и первичный ключ
    title VARCHAR(45) NOT NULL, -- название фильма на русском, обязательно к заполнению
    title_eng VARCHAR(45),
    year_movie YEAR NOT NULL,
    count_min INT NOT NULL,
    storyline TEXT
);

-- DML: INSERT, DELETE, UPDATE, SELECT
INSERT movie -- заполняем все столбцы в табличке movie
VALUES
	(100, "Игры разума", "A Beautiful Mind", 2001, 135, "...");
INSERT movie(title, title_eng, year_movie, count_min,storyline) -- заполняем конкретные столбцы: все, кроме id
VALUES
	("Игры разума", "A Beautiful Mind", 2001, 135, "...");
INSERT INTO movie (title, title_eng, year_movie, count_min, storyline)
VALUES 
	('Игры разума', 'A Beautiful Mind', 2001, 135, 'От всемирной известности до греховных глубин — все это познал на своей шкуре Джон Форбс Нэш-младший. Математический гений, он на заре своей карьеры сделал титаническую работу в области теории игр, которая перевернула этот раздел математики и практически принесла ему международную известность. Однако буквально в то же время заносчивый и пользующийся успехом у женщин Нэш получает удар судьбы, который переворачивает уже его собственную жизнь.'),
	('Форрест Гамп', 'Forrest Gump', 1994, 142, 'Сидя на автобусной остановке, Форрест Гамп — не очень умный, но добрый и открытый парень — рассказывает случайным встречным историю своей необыкновенной жизни. С самого малолетства парень страдал от заболевания ног, соседские мальчишки дразнили его, но в один прекрасный день Форрест открыл в себе невероятные способности к бегу. Подруга детства Дженни всегда его поддерживала и защищала, но вскоре дороги их разошлись.'),
	('Иван Васильевич меняет профессию', NULL, 1998, 128,'Инженер-изобретатель Тимофеев сконструировал машину времени, которая соединила его квартиру с далеким шестнадцатым веком - точнее, с палатами государя Ивана Грозного. Туда-то и попадают тезка царя пенсионер-общественник Иван Васильевич Бунша и квартирный вор Жорж Милославский. На их место в двадцатом веке «переселяется» великий государь. Поломка машины приводит ко множеству неожиданных и забавных событий...'),
	('Назад в будущее', 'Back to the Future', 1985, 116, 'Подросток Марти с помощью машины времени, сооружённой его другом-профессором доком Брауном, попадает из 80-х в далекие 50-е. Там он встречается со своими будущими родителями, ещё подростками, и другом-профессором, совсем молодым.'),
	('Криминальное чтиво', 'Pulp Fiction', 1994, 154, NULL);
    
SELECT *
FROM movie;

-- DDL: 
-- RENAME TABLE old_name TO new_name;
RENAME TABLE movie TO cinema;  -- movie теперь cinema
SELECT *
FROM cinema;

-- TRUNCATE - очистка данных в таблице, остаются только названия столбцов
TRUNCATE cinema;
SELECT *
FROM cinema;
INSERT INTO cinema (title, title_eng, year_movie, count_min, storyline)
VALUES 
	('Игры разума', 'A Beautiful Mind', 2001, 135, 'От всемирной известности до греховных глубин — все это познал на своей шкуре Джон Форбс Нэш-младший. Математический гений, он на заре своей карьеры сделал титаническую работу в области теории игр, которая перевернула этот раздел математики и практически принесла ему международную известность. Однако буквально в то же время заносчивый и пользующийся успехом у женщин Нэш получает удар судьбы, который переворачивает уже его собственную жизнь.'),
	('Форрест Гамп', 'Forrest Gump', 1994, 142, 'Сидя на автобусной остановке, Форрест Гамп — не очень умный, но добрый и открытый парень — рассказывает случайным встречным историю своей необыкновенной жизни. С самого малолетства парень страдал от заболевания ног, соседские мальчишки дразнили его, но в один прекрасный день Форрест открыл в себе невероятные способности к бегу. Подруга детства Дженни всегда его поддерживала и защищала, но вскоре дороги их разошлись.'),
	('Иван Васильевич меняет профессию', NULL, 1998, 128,'Инженер-изобретатель Тимофеев сконструировал машину времени, которая соединила его квартиру с далеким шестнадцатым веком - точнее, с палатами государя Ивана Грозного. Туда-то и попадают тезка царя пенсионер-общественник Иван Васильевич Бунша и квартирный вор Жорж Милославский. На их место в двадцатом веке «переселяется» великий государь. Поломка машины приводит ко множеству неожиданных и забавных событий...'),
	('Назад в будущее', 'Back to the Future', 1985, 116, 'Подросток Марти с помощью машины времени, сооружённой его другом-профессором доком Брауном, попадает из 80-х в далекие 50-е. Там он встречается со своими будущими родителями, ещё подростками, и другом-профессором, совсем молодым.'),
	('Криминальное чтиво', 'Pulp Fiction', 1994, 154, NULL);
    
-- ALTER TABLE
ALTER TABLE cinema
ADD test INT DEFAULT 100, -- в самом конце,  -- все значения в столбце тест = 100
ADD COLUMN price INT DEFAULT 200 AFTER id;  -- все значения в столбце прайс = 200

-- Переименовать столбец
ALTER TABLE cinema
CHANGE test hello INT DEFAULT 100; -- Переименовали столбец test, теперь столбец называется "hello"

-- Показ всех столбцов
SHOW COLUMNS FROM cinema;

ALTER TABLE cinema
DROP COLUMN hello;

-- UPDATE 
UPDATE cinema 
SET price = price + 150
WHERE title = 'Иван Васильевич меняет профессию' OR title = 'Игры разума' ; -- 200 + 150

SELECT *
FROM cinema;

-- Добавлю столбец категория, где будет рандомное число от 0 до 1
ALTER TABLE cinema
ADD category INT; -- создали новый столбец в таблице cinema

UPDATE cinema
SET category = RAND(); -- создается число от 0 до 1

SELECT *
FROM cinema;

-- 1 - заказ оплачен онлайн
-- 0 - заказ еще не оплачен

SELECT id, title, category, -- перед CASE ставится запятая
CASE
	WHEN category = 0 THEN "Заказ еще не оплачен, оплатите его :)"
    WHEN category = 1 THEN "Заказ  оплачен :)"
    ELSE "Error 404"
END AS result -- результат - псевдоним
FROM cinema;

-- IF (условие, значение_для_истины, значение_для_лжи)
SELECT IF (200>100, "200 больше, чем 100", "200 меньше, чем 100") AS result;

-- До 50 минут - короткометражка
-- 50 - 140 - среднеметражка
-- 141 - 150 - полномнетражка 
-- 150+ - очень долгий фильм 
SELECT 
	id AS "Номер фильма",
    title AS "Название фильма",
    count_min AS "Продолжительность",
    IF (count_min < 50, "короткометражка",
		IF (count_min BETWEEN 50 AND 142, "среднеметражка",
			IF (count_min BETWEEN 142 AND 150,"полномнетражка", "очень долгий фильм"))) -- Последний агрумент это ELSE
	AS "Тип фильма"
FROM cinema;
